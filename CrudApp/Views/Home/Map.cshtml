@model CrudApp.Models.ViewModels.BaseVm

@{
    Layout = "~/Views/Shared/_StormLayout1.cshtml";
}

@section Meta{
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <link href="~/Content/Leaflet/leafletStyles.css" rel="stylesheet" />
    <link href="~/Content/Leaflet/leaflet.toolbar.css" rel="stylesheet" />
    <link href="~/Content/Leaflet/leaflet.distortableimage.css" rel="stylesheet" />
}
<!-- Map -->
<div class="map-title">

    <div class="map-title-overlay"></div>

    <div class="container">

        <h1>@Model._Document.Title (@Model._Document.Date)</h1>

    </div>

</div>
<div class="width-full">
    <div class="row">
        <div id="map" class="map-display col-md-12 col-sm-12"></div>
    </div>
</div>




@section Scripts{
    <script src="~/Scripts/leaflet/leaflet-src.js"></script>
    <script src="~/Scripts/leaflet/leaflet.toolbar.js"></script>

    <script src="~/Scripts/leaflet/noMap.js"></script>
    <script src="~/Scripts/leaflet/tilesets.js"></script>

    <script src="~/Scripts/services/project.services.Leaflet.js"></script>

    <script>
        project.page.startUp = function () {

            // Get User's location
            project.services.IP.getLocation(project.page.onGetLocationSuccess, project.page.onAjaxError);

            $("body").find(".leaflet-image-layer").fadeOut();
        };

        // .....................................................................................
        // If user location retrieved successfully
        project.page.onGetLocationSuccess = function (locationObject) {
            // Centers display map on recieved latLng coordinates
            var latLng = {
                lat: locationObject.latitude,
                lng: locationObject.longitude
            };

            project.services.Leaflet.editMap(latLng);
        }

        // .....................................................................................

        project.page.onAjaxError = function (data) {
            console.log("An error occured: ", data);
        }

    </script>
}
